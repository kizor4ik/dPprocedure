(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     27786,        785]
NotebookOptionsPosition[     27170,        767]
NotebookOutlinePosition[     27513,        782]
CellTagsIndexPosition[     27470,        779]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\[Epsilon]1", " ", "=", " ", "1"}], ",", 
    RowBox[{"\[Epsilon]2", " ", "=", " ", "1.2"}], ",", 
    RowBox[{"q", " ", "=", "10"}], ",", " ", 
    RowBox[{"L", " ", "=", "1"}]}], "}"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ko", " ", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"np", "=", "0.01"}], ";"}]}], "Input",ExpressionUUID->"0e0fd640-\
6789-467b-93a8-5e88a297e30a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "(*", "\:0438\:043d\:0438\:0446\:0430\:043b\:0438\:0437\:0430\:0446\:0438\
\:044f", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"long", " ", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"k0", "=", " ", 
        RowBox[{
         SqrtBox["\[Epsilon]2"], "ko"}]}], ",", 
       RowBox[{"k3", " ", "=", "  ", 
        SqrtBox[
         RowBox[{
          RowBox[{"\[Epsilon]2", " ", 
           SuperscriptBox["ko", "2"]}], "-", 
          SuperscriptBox["kp", "2"]}]]}], ",", 
       RowBox[{
        SubscriptBox["k", "3"], "=", 
        SqrtBox[
         RowBox[{
          SuperscriptBox["ko", "2"], "-", 
          SuperscriptBox["kp", "2"]}]]}], ",", " ", 
       RowBox[{"\[Delta]\[Epsilon]", " ", "=", 
        FractionBox[
         RowBox[{" ", 
          RowBox[{"\[Epsilon]1", " ", "-", " ", "\[Epsilon]2"}]}], 
         "\[Epsilon]2"]}], ",", " ", 
       RowBox[{"kp", "=", 
        RowBox[{"np", " ", "ko"}]}], ",", 
       RowBox[{"n3", "=", " ", 
        FractionBox[
         SqrtBox[
          RowBox[{
           RowBox[{"\[Epsilon]2", " ", 
            SuperscriptBox["ko", "2"]}], "-", 
           SuperscriptBox["kp", "2"]}]], "ko"]}], ",", 
       RowBox[{"n32", " ", "=", " ", 
        FractionBox[
         RowBox[{
          FractionBox["2", "\[Pi]"], 
          RowBox[{"EllipticE", "[", 
           FractionBox[
            RowBox[{
             RowBox[{"-", 
              SuperscriptBox["kp", "2"]}], "\[Delta]\[Epsilon]"}], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", "\[Delta]\[Epsilon]"}], ")"}], 
             SuperscriptBox["k3", "2"]}]], "]"}], 
          SqrtBox[
           RowBox[{"(", 
            RowBox[{"1", "+", "\[Delta]\[Epsilon]"}], ")"}]], "k3"}], "ko"]}],
        ",", 
       RowBox[{"p3", "=", " ", 
        RowBox[{
         FractionBox["2", "\[Pi]"], 
         RowBox[{"EllipticE", "[", 
          FractionBox[
           RowBox[{
            RowBox[{"-", 
             SuperscriptBox["kp", "2"]}], "\[Delta]\[Epsilon]"}], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "+", "\[Delta]\[Epsilon]"}], ")"}], 
            SuperscriptBox["k3", "2"]}]], "]"}], 
         SqrtBox[
          RowBox[{"(", 
           RowBox[{"1", "+", "\[Delta]\[Epsilon]"}], ")"}]], "k3"}]}], ",", 
       " ", 
       RowBox[{"\[Chi]1", " ", "=", " ", 
        RowBox[{"\[Epsilon]1", "-", "1"}]}], ",", " ", 
       RowBox[{"\[Chi]2", " ", "=", " ", 
        RowBox[{"\[Epsilon]2", "-", "1"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"S", "[", "z_", "]"}], ":=", " ", 
     RowBox[{
      SuperscriptBox["q", 
       RowBox[{"-", "1"}]], 
      SqrtBox[
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", "\[Delta]\[Epsilon]"}], ")"}], 
        SuperscriptBox["k3", "2"]}]], 
      RowBox[{"EllipticE", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ",", 
        FractionBox[
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox["kp", "2"]}], "\[Delta]\[Epsilon]"}], 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "+", "\[Delta]\[Epsilon]"}], ")"}], 
          SuperscriptBox["k3", "2"]}]]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:043c\:043e\:0434\:043e\:0432\:044b\:0435", " ", 
     "\:0444\:0443\:043d\:043a\:0446\:0438\:0438", " ", "\:0434\:043b\:044f", 
     " ", "\:043a\:0432\:0430\:0437\:0438\:043a\:043b\:0430\:0441\:0441\:0438\
\:043a\:0438", " ", "vcb_", " ", "\:0441", " ", 
     "\:0443\:0447\:0435\:0442\:043e\:043c", " ", 
     "\:043f\:0440\:0438\:043c\:0435\:043d\:0438\:043c\:043e\:0441\:0442\:0438\
", " ", "\:0442\:0435\:043e\:0440\:0438\:0438", " ", 
     RowBox[{"(", 
      RowBox[{
      "\:0432\:0435\:0434\:0443\:0449\:0438\:0439", " ", 
       "\:043f\:043e\:0440\:044f\:0434\:043e\:043a", " ", "\:043f\:043e", " ", 
       RowBox[{"n_", "\\", "perp"}]}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:043e\:0431\:044b\:043a\:043d\:043e\:0432\:0435\:043d\:043d\:0430\:044f\
", " ", "\:0432\:043e\:043b\:043d\:0430"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"a1p", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", "k0"}], ")"}], 
       RowBox[{
        RowBox[{"-", "1"}], "/", "2"}]], "\[ImaginaryI]", " ", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}]}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", " ", "k3", " ", "z"}]]}]}], " ", ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"a1m", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", "k0"}], ")"}], 
       RowBox[{
        RowBox[{"-", "1"}], "/", "2"}]], 
      RowBox[{"(", 
       RowBox[{"-", "\[ImaginaryI]"}], ")"}], " ", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}]}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", " ", "k3", " ", "z"}]]}]}], " ", ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"a13", "[", "z_", "]"}], " ", ":=", " ", 
     FractionBox[
      RowBox[{"kp", " ", 
       RowBox[{"Sin", "[", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}], "]"}], 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k3", " ", "z"}]]}], 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", 
         SuperscriptBox["k0", "3"]}], ")"}], 
       RowBox[{"1", "/", "2"}]]]}], " ", ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "\:043e\:0442\:0440\:0430\:0436\:0435\:043d\:043d\:0430\:044f", " ", 
     "\:043e\:0431\:044b\:0447\:043d\:043e\:0432\:0435\:043d\:043d\:0430\:044f\
", " ", "\:0432\:043e\:043b\:043d\:0430"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"b1p", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", "k0"}], ")"}], 
       RowBox[{
        RowBox[{"-", "1"}], "/", "2"}]], "\[ImaginaryI]", " ", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}]}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], " ", "k3", " ", "z"}]]}]}], " ", 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"b1m", " ", "[", "z_", "]"}], ":=", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", "k0"}], ")"}], 
       RowBox[{
        RowBox[{"-", "1"}], "/", "2"}]], 
      RowBox[{"(", 
       RowBox[{"-", "\[ImaginaryI]"}], ")"}], " ", 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}]}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], " ", "k3", " ", "z"}]]}]}], " ", 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"b13", "[", "z_", "]"}], " ", ":=", " ", 
     FractionBox[
      RowBox[{
       RowBox[{"-", "kp"}], " ", 
       RowBox[{"Sin", "[", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}], "]"}], 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", "k3", " ", "z"}]]}], 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", 
         SuperscriptBox["k0", "3"]}], ")"}], 
       RowBox[{"1", "/", "2"}]]]}], " ", ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:043d\:0435\:043e\:0431\:044b\:043a\:043d\:043e\:0432\:0435\:043d\:043d\
\:0430\:044f", " ", "\:0432\:043e\:043b\:043d\:0430"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"a2p", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", "ko", " ", 
         SuperscriptBox["\[Epsilon]1", 
          RowBox[{"1", "/", "2"}]]}], ")"}], 
       RowBox[{
        RowBox[{"-", "1"}], "/", "2"}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}]}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", " ", 
        RowBox[{"S", "[", "z", "]"}]}]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"a2m", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", "ko", " ", 
         SuperscriptBox["\[Epsilon]1", 
          RowBox[{"1", "/", "2"}]]}], ")"}], 
       RowBox[{
        RowBox[{"-", "1"}], "/", "2"}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}]}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", " ", 
        RowBox[{"S", "[", "z", "]"}]}]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"a23", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"-", "kp"}], " ", 
      RowBox[{"Cos", "[", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}], "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        FractionBox[
         RowBox[{"ko", " ", 
          SuperscriptBox["\[Epsilon]1", 
           RowBox[{"1", "/", "2"}]]}], 
         RowBox[{"2", " ", 
          SuperscriptBox["k0", "4"]}]], ")"}], 
       RowBox[{"1", "/", "2"}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", " ", 
        RowBox[{"S", "[", "z", "]"}]}]]}]}], " ", ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:043d\:0435\:043e\:0431\:044b\:043a\:043d\:043e\:0432\:0435\:043d\:043d\
\:0430\:044f", " ", 
     "\:043e\:0442\:0440\:0430\:0436\:0435\:043d\:043d\:0430\:044f", " ", 
     "\:0432\:043e\:043b\:043d\:0430"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"b2p", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", "ko", " ", 
         SuperscriptBox["\[Epsilon]1", 
          RowBox[{"1", "/", "2"}]]}], ")"}], 
       RowBox[{
        RowBox[{"-", "1"}], "/", "2"}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}]}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], " ", 
        RowBox[{"S", "[", "z", "]"}]}]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"b2m", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"2", "ko", " ", 
         SuperscriptBox["\[Epsilon]1", 
          RowBox[{"1", "/", "2"}]]}], ")"}], 
       RowBox[{
        RowBox[{"-", "1"}], "/", "2"}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], "  ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}]}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], " ", 
        RowBox[{"S", "[", "z", "]"}]}]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"b23", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{"kp", " ", 
      RowBox[{"Cos", "[", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"q", " ", "z"}], "-", "\[Phi]"}], ")"}], "]"}], " ", 
      SuperscriptBox[
       RowBox[{"(", 
        FractionBox[
         RowBox[{"ko", " ", 
          SuperscriptBox["\[Epsilon]1", 
           RowBox[{"1", "/", "2"}]]}], 
         RowBox[{"2", " ", 
          SuperscriptBox["k0", "4"]}]], ")"}], 
       RowBox[{"1", "/", "2"}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], " ", 
        RowBox[{"S", "[", "z", "]"}]}]]}]}], " ", ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"K", " ", "=", " ", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         RowBox[{"1", "+", 
          FractionBox[
           SuperscriptBox["kp", "2"], 
           RowBox[{"2", " ", 
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox["k0", "2"], "-", 
              SuperscriptBox["kp", "2"]}], ")"}]}]]}], 
         FractionBox[
          SuperscriptBox["kp", "2"], 
          RowBox[{"2", " ", 
           RowBox[{"(", 
            RowBox[{
             SuperscriptBox["k0", "2"], "-", 
             SuperscriptBox["kp", "2"]}], ")"}]}]]},
        {
         FractionBox[
          SuperscriptBox["kp", "2"], 
          RowBox[{"2", " ", 
           RowBox[{"(", 
            RowBox[{
             SuperscriptBox["k0", "2"], "-", 
             SuperscriptBox["kp", "2"]}], ")"}]}]], 
         RowBox[{"1", "+", 
          FractionBox[
           SuperscriptBox["kp", "2"], 
           RowBox[{"2", " ", 
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox["k0", "2"], "-", 
              SuperscriptBox["kp", "2"]}], ")"}]}]]}]}
       }], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"u11", "[", "z_", "]"}], " ", ":=", " ", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         RowBox[{"a1p", "[", "z", "]"}], 
         RowBox[{"a2p", "[", "z", "]"}]},
        {
         RowBox[{"a1m", "[", "z", "]"}], 
         RowBox[{"a2m", "[", "z", "]"}]}
       }], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"u12", "[", "z_", "]"}], ":=", " ", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         RowBox[{"b1p", "[", "z", "]"}], 
         RowBox[{"b2p", "[", "z", "]"}]},
        {
         RowBox[{"b1m", "[", "z", "]"}], 
         RowBox[{"b2m", "[", "z", "]"}]}
       }], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"u21", "[", "z_", "]"}], ":=", " ", 
     RowBox[{
      RowBox[{"-", "\[ImaginaryI]"}], " ", 
      RowBox[{"K", ".", " ", 
       RowBox[{
        RowBox[{"u11", "'"}], "[", "z", "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"u22", "[", "z_", "]"}], ":=", " ", 
     RowBox[{
      RowBox[{"-", "\[ImaginaryI]"}], " ", 
      RowBox[{"K", ".", " ", 
       RowBox[{
        RowBox[{"u12", "'"}], "[", "z", "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"u", "=", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {
         RowBox[{
          RowBox[{"u11", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u11", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u12", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u12", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}]},
        {
         RowBox[{
          RowBox[{"u11", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u11", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u12", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u12", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}]},
        {
         RowBox[{
          RowBox[{"u21", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u21", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u22", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u22", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}]},
        {
         RowBox[{
          RowBox[{"u21", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u21", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u22", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}], 
         RowBox[{
          RowBox[{"u22", "[", "0", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}]}
       }], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gT", " ", "=", 
     RowBox[{
      FractionBox["1", 
       SqrtBox["2"]], " ", 
      RowBox[{"(", "\[NoBreak]", GridBox[{
         {
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             SuperscriptBox["np", "2"]}]], " ", "-", "s"}], 
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             SuperscriptBox["np", "2"]}]], "+", "s"}], 
          RowBox[{"ko", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"s", " ", 
              SqrtBox[
               RowBox[{"1", "-", 
                SuperscriptBox["np", "2"]}]]}]}], ")"}]}], 
          RowBox[{"ko", 
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"s", " ", 
              SqrtBox[
               RowBox[{"1", "-", 
                SuperscriptBox["np", "2"]}]]}]}], ")"}]}]}
        }], "\[NoBreak]", ")"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"r1", ",", "r2", ",", "l1", ",", "l2"}], "}"}], " ", "=", 
     RowBox[{"LinearSolve", "[", 
      RowBox[{"u", ",", 
       RowBox[{"gT", "\[Transpose]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:0441\:0431\:043e\:0440\:043a\:0430", " ", 
     "\:0432\:043e\:043b\:043d\:043e\:0432\:043e\:0439", " ", 
     "\:0444\:0443\:043d\:043a\:0446\:0438\:0438"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]p", "[", 
      RowBox[{"x1_", ",", "x2_", ",", "z_"}], "]"}], " ", "=", 
     RowBox[{
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{"r1", " ", 
         RowBox[{"a1p", "[", "z", "]"}]}], "+", 
        RowBox[{"l1", " ", 
         RowBox[{"b1p", "[", "z", "]"}]}], "+", 
        RowBox[{"r2", " ", 
         RowBox[{"a2p", "[", "z", "]"}]}], "+", 
        RowBox[{"l2", " ", 
         RowBox[{"b2p", "[", "z", "]"}]}]}], ")"}], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", " ", "\[Phi]"}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"kx", " ", "x1"}], "+", 
          RowBox[{"ky", " ", "x2"}]}], ")"}]}]]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]m", "[", 
      RowBox[{"x1_", ",", "x2_", ",", "z_"}], "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"r1", " ", 
         RowBox[{"a1m", "[", "z", "]"}]}], "+", 
        RowBox[{"l1", " ", 
         RowBox[{"b1m", "[", "z", "]"}]}], "+", 
        RowBox[{"r2", " ", 
         RowBox[{"a2m", "[", "z", "]"}]}], "+", 
        RowBox[{"l2", " ", 
         RowBox[{"b2m", "[", "z", "]"}]}]}], " ", ")"}], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Phi]"}]], 
      SuperscriptBox["\[ExponentialE]", 
       RowBox[{"\[ImaginaryI]", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"kx", " ", "x1"}], "+", 
          RowBox[{"ky", " ", "x2"}]}], ")"}]}]]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]3", "[", 
      RowBox[{"x1_", ",", "x2_", ",", "z_"}], "]"}], " ", "=", 
     RowBox[{"\[ImaginaryI]", " ", 
      FractionBox["kp", 
       RowBox[{"2", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["k0", "2"], "-", 
          SuperscriptBox["kp", "2"]}], ")"}]}]], 
      RowBox[{"D", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"\[Psi]p", "[", 
           RowBox[{"x1", ",", "x2", ",", "z"}], "]"}], " ", 
          SuperscriptBox["\[ExponentialE]", 
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Phi]"}]]}], "+", 
         RowBox[{
          RowBox[{"\[Psi]m", "[", 
           RowBox[{"x1", ",", "x2", ",", "z"}], "]"}], " ", 
          SuperscriptBox["\[ExponentialE]", 
           RowBox[{"\[ImaginaryI]", " ", "\[Phi]"}]]}]}], ",", "z"}], 
       "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "**", "**", "**", 
      "\:043d\:043e\:0440\:043c\:0438\:0440\:043e\:0432\:043e\:0447\:043d\
\:044b\:0439"}], " ", 
     RowBox[{
     "\:043c\:043d\:043e\:0436\:0438\:0442\:0435\:043b\:044c", "**", "**", "**",
       "**", "**", "**"}]}], "******)"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.8052458211272073`*^9, 3.805245889197594*^9}, {
   3.805245926701635*^9, 3.8052460559338913`*^9}, {3.805246109454794*^9, 
   3.8052461096278944`*^9}, {3.80524615371861*^9, 3.80524617908619*^9}, {
   3.8052462150566726`*^9, 3.805246380035141*^9}, {3.805246492025483*^9, 
   3.8052467278474865`*^9}, {3.805246831052144*^9, 3.8052469271742077`*^9}, {
   3.805246970040659*^9, 3.8052471375031743`*^9}, {3.8052472075809765`*^9, 
   3.805247207674658*^9}, {3.8052473468788595`*^9, 3.8052473491568584`*^9}, 
   3.8052473997758045`*^9, {3.805247478648308*^9, 3.805247598521609*^9}, {
   3.805247802230409*^9, 3.8052480210125847`*^9}, {3.805248067459899*^9, 
   3.805248068611682*^9}, {3.8052481007261047`*^9, 3.8052481105980897`*^9}, {
   3.8052491122653093`*^9, 3.8052491174907646`*^9}, {3.805249197027835*^9, 
   3.805249224057975*^9}, {3.8052493126451807`*^9, 3.805249312783598*^9}, {
   3.8052493508182106`*^9, 3.8052493949708023`*^9}, {3.805249433276743*^9, 
   3.8052494747664156`*^9}, {3.8052495495535574`*^9, 
   3.8052495942756085`*^9}, {3.8052496377885585`*^9, 3.805249643771554*^9}, {
   3.805250027250238*^9, 3.8052500305400963`*^9}, {3.8052501726387615`*^9, 
   3.805250197921996*^9}, {3.805250231494066*^9, 3.8052502339011025`*^9}, {
   3.805250266001926*^9, 3.8052502816319075`*^9}, {3.805250342698042*^9, 
   3.8052503485771413`*^9}, {3.805284349417221*^9, 3.805284407986968*^9}, {
   3.8052844604978437`*^9, 3.8052844885688143`*^9}, {3.8052846778296623`*^9, 
   3.8052846818719263`*^9}, {3.805284880494815*^9, 3.8052850019116673`*^9}, 
   3.805285492544615*^9, {3.805285545533616*^9, 3.8052856360954056`*^9}, {
   3.805285672005165*^9, 3.8052857429090242`*^9}, {3.8052857762801027`*^9, 
   3.8052860688765497`*^9}, {3.805286110550056*^9, 3.8052862712310944`*^9}, {
   3.8052867770063753`*^9, 3.8052868530351*^9}, {3.8052872025276194`*^9, 
   3.8052872781590776`*^9}, {3.8052873321465387`*^9, 3.805287353333227*^9}, 
   3.805287543772175*^9, {3.8052919687394466`*^9, 3.8052920308760557`*^9}, {
   3.805292099787036*^9, 3.805292108248047*^9}, {3.805292831469389*^9, 
   3.8052928572271404`*^9}, {3.805292969707693*^9, 3.805292975940134*^9}, {
   3.805293038029595*^9, 3.805293104717797*^9}, 
   3.8052931549351254`*^9},ExpressionUUID->"484e4e66-0330-499f-ab0b-\
0d397054422a"],

Cell[CellGroupData[{

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8052929884931726`*^9, 
  3.805293018728814*^9}},ExpressionUUID->"b9bdaa7f-1426-48ca-a5d1-\
e396afb90dfe"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   FractionBox["1", 
    RowBox[{"2", " ", 
     SuperscriptBox["ko", "2"], " ", "\[Epsilon]2"}]], 
   RowBox[{
    SqrtBox[
     RowBox[{"ko", " ", 
      SqrtBox["\[Epsilon]2"]}]], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[ImaginaryI]", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"q", " ", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["ko", "2"], " ", "\[Epsilon]2"}]]}], "+", 
         RowBox[{"ko", " ", "s", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ko", " ", "\[Epsilon]2"}], "+", 
            SqrtBox[
             RowBox[{
              SuperscriptBox["ko", "2"], " ", "\[Epsilon]2"}]]}], ")"}]}]}], 
        ")"}], " ", 
       RowBox[{"Cos", "[", "\[Phi]", "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox["ko", "2"], " ", "\[Epsilon]2"}], "+", 
         RowBox[{"ko", " ", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["ko", "2"], " ", "\[Epsilon]2"}]]}], "+", 
         RowBox[{"q", " ", "s", " ", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["ko", "2"], " ", "\[Epsilon]2"}]]}]}], ")"}], " ", 
       RowBox[{"Sin", "[", "\[Phi]", "]"}]}]}], ")"}]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8052929891154895`*^9, 3.805293007590472*^9}},
 CellLabel->"Out[25]=",ExpressionUUID->"60acfdca-a86c-4caa-833a-b3a2e13b26b5"]
}, Open  ]]
},
WindowSize->{759, 833},
WindowMargins->{{673, Automatic}, {75, Automatic}},
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 474, 12, 67, "Input",ExpressionUUID->"0e0fd640-6789-467b-93a8-5e88a297e30a"],
Cell[1035, 34, 24480, 678, 1350, "Input",ExpressionUUID->"484e4e66-0330-499f-ab0b-0d397054422a"],
Cell[CellGroupData[{
Cell[25540, 716, 154, 3, 28, "Input",ExpressionUUID->"b9bdaa7f-1426-48ca-a5d1-e396afb90dfe"],
Cell[25697, 721, 1457, 43, 91, "Output",ExpressionUUID->"60acfdca-a86c-4caa-833a-b3a2e13b26b5"]
}, Open  ]]
}
]
*)

